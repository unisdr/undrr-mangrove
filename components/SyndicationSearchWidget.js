/*!
 * This is a UNDRR Mangrove component: https://github.com/unisdr/undrr-mangrove?tab=readme-ov-file
 * Compiled on: 2026-02-13T13:18:40.811Z
 */
/*! For license information please see SyndicationSearchWidget.js.LICENSE.txt */
import*as e from"react";import{createPortal as t}from"react-dom";var a={2884(e,t,a){a.d(t,{i:()=>u});var s=a(1649),r=a(5556),n=a.n(r),l=a(4848);function i({page:e,totalPages:t,onPageChange:a,isLoading:r=!1}){const n=(0,s.useMemo)(()=>function(e,t){if(null==t)return[{type:"page",number:e}];if(t<=1)return[];const a=[],s=Math.floor(2.5);let r=Math.max(1,e-s),n=Math.min(t,r+5-1);n-r<4&&(r=Math.max(1,n-5+1)),r>1&&(a.push({type:"page",number:1}),r>2&&a.push({type:"ellipsis",key:"start"}));for(let e=r;e<=n;e++)(1!==e&&e!==t||1===e&&1===r||e===t&&n===t)&&a.push({type:"page",number:e});return n<t&&(n<t-1&&a.push({type:"ellipsis",key:"end"}),a.push({type:"page",number:t})),a}(e,t),[e,t]),i=(0,s.useCallback)(s=>{s<1||null!=t&&s>t||s!==e&&a(s)},[a,e,t]),o=(0,s.useCallback)((e,t)=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i(t))},[i]);if(null!=t&&t<=1)return null;const c=e>1,u=null==t||e<t;return(0,l.jsxs)("ul",{className:"mg-pager__list",children:[(0,l.jsx)("li",{className:"mg-pager__item mg-pager__item--prev",children:(0,l.jsxs)("button",{type:"button",className:"mg-pager__link mg-pager__link--prev "+(c?"":"mg-pager__link--disabled"),onClick:()=>i(e-1),onKeyDown:t=>o(t,e-1),disabled:!c||r,"aria-label":"Go to previous page","aria-disabled":!c,children:[(0,l.jsx)("svg",{className:"mg-pager__icon",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,l.jsx)("polyline",{points:"15 18 9 12 15 6"})}),(0,l.jsx)("span",{className:"mg-pager__text",children:"Previous"})]})}),n.map(t=>{if("ellipsis"===t.type)return(0,l.jsx)("li",{className:"mg-pager__item mg-pager__item--ellipsis","aria-hidden":"true",children:(0,l.jsx)("span",{className:"mg-pager__ellipsis",children:"…"})},t.key);const a=t.number===e;return(0,l.jsx)("li",{className:"mg-pager__item",children:(0,l.jsx)("button",{type:"button",className:"mg-pager__link mg-pager__link--number "+(a?"mg-pager__link--current":""),onClick:()=>i(t.number),onKeyDown:e=>o(e,t.number),disabled:r,"aria-label":`Page ${t.number}${a?", current page":""}`,"aria-current":a?"page":void 0,children:t.number})},t.number)}),(0,l.jsx)("li",{className:"mg-pager__item mg-pager__item--next",children:(0,l.jsxs)("button",{type:"button",className:"mg-pager__link mg-pager__link--next "+(u?"":"mg-pager__link--disabled"),onClick:()=>i(e+1),onKeyDown:t=>o(t,e+1),disabled:!u||r,"aria-label":"Go to next page","aria-disabled":!u,children:[(0,l.jsx)("span",{className:"mg-pager__text",children:"Next"}),(0,l.jsx)("svg",{className:"mg-pager__icon",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,l.jsx)("polyline",{points:"9 18 15 12 9 6"})})]})})]})}function o({range:e,rangeLabel:t="Showing {start}–{end}"}){if(!e)return null;const a=t.replace("{start}",e.start).replace("{end}",e.end);return(0,l.jsx)("p",{className:"mg-pager__range","aria-live":"polite",children:a})}function c({jumpToLabel:e="Go to page",jumpToAction:t="Go",onPageChange:a,totalPages:r,isLoading:n=!1}){const[i,o]=(0,s.useState)(""),c=(0,s.useCallback)(e=>{e.preventDefault();const t=parseInt(i,10);if(Number.isNaN(t)||t<1)return;let s=t;null!=r&&(s=Math.min(s,r)),s=Math.max(1,s),a(s),o("")},[i,a,r]),u="mg-pager-jump-input";return(0,l.jsxs)("form",{className:"mg-pager__jump",onSubmit:c,children:[(0,l.jsx)("label",{className:"mg-pager__jump-label",htmlFor:u,children:e}),(0,l.jsx)("input",{id:u,className:"mg-pager__jump-input",type:"number",min:1,max:null!=r?r:void 0,value:i,onChange:e=>o(e.target.value),disabled:n,"aria-label":e}),(0,l.jsx)("button",{type:"submit",className:"mg-pager__jump-btn",disabled:n||!i,children:t})]})}function u({page:e,totalPages:t=null,onPageChange:a,isLoading:s=!1,layout:r="centered",ariaLabel:n="Pagination",range:u,rangeLabel:d,showJumpTo:m=!1,jumpToLabel:p,jumpToAction:g,emptyState:h,emptyAction:f}){return h?(0,l.jsx)("nav",{className:"mg-pager","aria-label":n,children:(0,l.jsxs)("p",{className:"mg-pager__notice",children:[h,f&&(0,l.jsxs)(l.Fragment,{children:[" ",(0,l.jsx)("button",{type:"button",className:"mg-pager__notice-action",onClick:f.onClick,children:f.label})]})]})}):"bar"===r?(0,l.jsxs)("nav",{className:"mg-pager","aria-label":n,children:[(0,l.jsxs)("div",{className:"mg-pager__bar",children:[u&&(0,l.jsx)(o,{range:u,rangeLabel:d}),(0,l.jsx)(i,{page:e,totalPages:t,onPageChange:a,isLoading:s}),m&&(0,l.jsx)(c,{jumpToLabel:p,jumpToAction:g,onPageChange:a,totalPages:t,isLoading:s})]}),(0,l.jsxs)("div",{className:"mg-u-sr-only","aria-live":"polite",children:["Page ",e,null!=t&&` of ${t}`]})]}):(0,l.jsxs)("nav",{className:"mg-pager","aria-label":n,children:[(0,l.jsx)(i,{page:e,totalPages:t,onPageChange:a,isLoading:s}),(0,l.jsxs)("div",{className:"mg-u-sr-only","aria-live":"polite",children:["Page ",e,null!=t&&` of ${t}`]})]})}i.propTypes={page:n().number.isRequired,totalPages:n().number,onPageChange:n().func.isRequired,isLoading:n().bool},o.propTypes={range:n().shape({start:n().number.isRequired,end:n().number.isRequired}),rangeLabel:n().string},c.propTypes={jumpToLabel:n().string,jumpToAction:n().string,onPageChange:n().func.isRequired,totalPages:n().number,isLoading:n().bool},u.propTypes={page:n().number.isRequired,totalPages:n().number,onPageChange:n().func.isRequired,isLoading:n().bool,layout:n().oneOf(["centered","bar"]),ariaLabel:n().string,range:n().shape({start:n().number.isRequired,end:n().number.isRequired}),rangeLabel:n().string,showJumpTo:n().bool,jumpToLabel:n().string,jumpToAction:n().string,emptyState:n().string,emptyAction:n().shape({label:n().string.isRequired,onClick:n().func.isRequired})}},2694(e,t,a){var s=a(6925);function r(){}function n(){}n.resetWarningCache=r,e.exports=function(){function e(e,t,a,r,n,l){if(l!==s){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:n,resetWarningCache:r};return a.PropTypes=a,a}},5556(e,t,a){e.exports=a(2694)()},6925(e){e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},9698(e,t){var a=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function r(e,t,s){var r=null;if(void 0!==s&&(r=""+s),void 0!==t.key&&(r=""+t.key),"key"in t)for(var n in s={},t)"key"!==n&&(s[n]=t[n]);else s=t;return t=s.ref,{$$typeof:a,type:e,key:r,ref:void 0!==t?t:null,props:s}}t.Fragment=s,t.jsx=r,t.jsxs=r},4848(e,t,a){e.exports=a(9698)},1649(t,a,s){var r,n;t.exports=(r={Suspense:()=>e.Suspense,createContext:()=>e.createContext,useCallback:()=>e.useCallback,useContext:()=>e.useContext,useDeferredValue:()=>e.useDeferredValue,useEffect:()=>e.useEffect,useId:()=>e.useId,useMemo:()=>e.useMemo,useReducer:()=>e.useReducer,useRef:()=>e.useRef,useState:()=>e.useState,useTransition:()=>e.useTransition},n={},s.d(n,r),n)}},s={};function r(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return a[e](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n=r(1649);const l=[{id:"www_undrr_org",name:"UNDRR.org",url:"https://www.undrr.org"},{id:"www_preventionweb_net",name:"PreventionWeb",url:"https://www.preventionweb.net"},{id:"recovery_preventionweb_net",name:"International Recovery Platform",url:"https://recovery.preventionweb.net"},{id:"gp_preventionweb_net",name:"Global Platform",url:"https://globalplatform.undrr.org"},{id:"mcr2030_undrr_org",name:"MCR2030",url:"https://mcr2030.undrr.org"},{id:"iddrr_undrr_org",name:"IDDRR",url:"https://iddrr.undrr.org"},{id:"rp_americas_undrr_org",name:"RP Americas",url:"https://rp-americas.undrr.org"},{id:"sendaiframework_mtr_undrr_org",name:"MTR SF",url:"https://sendaiframework-mtr.undrr.org"},{id:"tsunamiday_undrr_org",name:"World Tsunami Awareness Day",url:"https://tsunamiday.undrr.org"},{id:"rp_arabstates_undrr_org",name:"RP Arab States",url:"https://rp-arabstates.undrr.org"},{id:"g20drrwg_preventionweb_net",name:"G20 DRRWG",url:"https://g20drrwg.preventionweb.net"},{id:"afrp_undrr_org",name:"Africa Regional Platform",url:"https://afrp.undrr.org"},{id:"efdrr_undrr_org",name:"EFDRR",url:"https://efdrr.undrr.org"},{id:"apmcdrr_undrr_org",name:"APMCDRR",url:"https://apmcdrr.undrr.org"},{id:"coecdr_preventionweb_net",name:"Centre of Excellence",url:"https://coecdr.preventionweb.net"},{id:"ariseglobalnetwork_org",name:"ARISE",url:"https://arise.undrr.org"}],i=[{id:"news",name:"News"},{id:"event",name:"Event"},{id:"conference_event",name:"Conference event"},{id:"landing_page_gutenberg",name:"Landing pages"},{id:"landing",name:"Landing and thematic pages"},{id:"vacancy",name:"Vacancy"},{id:"resource",name:"Resources and training"},{id:"collections",name:"Collection guide"},{id:"publication",name:"Publication"},{id:"blog",name:"DRR Voices"},{id:"terminology",name:"Term"},{id:"organization",name:"Organization"},{id:"national_platform",name:"National Platform"},{id:"hazard_information_profile",name:"Hazard information profile"},{id:"conference",name:"Conference"},{id:"commitment",name:"Commitment"},{id:"focal_point",name:"Focal point"},{id:"people",name:"People"}],o={news:{field:"field_news_type",options:[{id:"751",name:"Update"},{id:"752",name:"Press release"},{id:"1",name:"Statements and messages"},{id:"754",name:"Feature"},{id:"755",name:"Research briefs"},{id:"797",name:"Community announcement"},{id:"756",name:"Op Ed"}]},blog:{field:"field_blog_type",options:[{id:"822",name:"Blog"},{id:"880",name:"Interview"}]},publication:{field:"undrr_publication_type",options:[{id:"744",name:"Fact sheet"},{id:"749",name:"Newsletter"},{id:"750",name:"Other"},{id:"1027",name:"Policy brief"},{id:"746",name:"Reports"},{id:"743",name:"Tool kit"},{id:"745",name:"UNDRR Document"},{id:"747",name:"Words into Action"},{id:"748",name:"Working paper"}]},resource:{field:"field_resource_type",options:[{id:"61",name:"Academic programme"},{id:"1181",name:"Case study"},{id:"62",name:"Training course"}]},organization:{field:"field_organization_type",options:[{id:"academicscientific",name:"Academic & scientific"},{id:"governments",name:"Governments"},{id:"nongovernmentalorganizations",name:"Non-governmental organizations"},{id:"newsandmedia",name:"News & media"},{id:"privatesector",name:"Private sector"},{id:"networksandothers",name:"Networks & others"},{id:"arise_member",name:"ARISE member"},{id:"uninternationalorganizations",name:"UN & international organizations"},{id:"regionalintergovernmentalorganizations",name:"Regional intergovernmental organizations"},{id:"arise_network",name:"ARISE network"}]}},c=o.news.options,u=[{id:"en",name:"English",default:!0},{id:"es",name:"Spanish"},{id:"fr",name:"French"},{id:"de",name:"German"},{id:"ja",name:"Japanese"},{id:"ar",name:"Arabic"},{id:"ko",name:"Korean"},{id:"zh-hans",name:"Chinese"},{id:"ru",name:"Russian"},{id:"pt-pt",name:"Portuguese"},{id:"und",name:"Undetermined"},{id:"zxx",name:"No language specified"}],d=["_language","field_domain_access","year","type"],m=[{key:"field_domain_access",label:"Website",vocabulary:"field_domain_access",type:"select-single"},{key:"type",label:"Type",vocabulary:"type",type:"select-multiple"},{key:"field_news_type",label:"News type",vocabulary:"terms",type:"select-multiple"},{key:"field_blog_type",label:"Blog type",vocabulary:"terms",type:"select-multiple"},{key:"undrr_publication_type",label:"Publication type",vocabulary:"terms",type:"select-multiple"},{key:"field_resource_type",label:"Resource type",vocabulary:"terms",type:"select-multiple"},{key:"field_organization_type",label:"Organization type",vocabulary:"list",type:"select-multiple"},{key:"year",label:"Year",type:"select-multiple"},{key:"field_country_region",label:"Country and region",vocabulary:"terms",type:"select-multiple"},{key:"field_hazard",label:"Hazard",vocabulary:"terms",type:"select-multiple"},{key:"field_theme",label:"Theme",vocabulary:"terms",type:"select-multiple"},{key:"_language",label:"Language",vocabulary:"languages",type:"select-single"}],p={contentTypeBoosts:{landing:5,terminology:1.5},fieldWeights:{title:9,teaser:1.2,body:1,saa_field_attachment:.1},phraseBoosts:{teaser:{match:1,exactPhrase:5,nearPhrase:3},title:{match:2,exactPhrase:15,nearPhrase:10},body:{exactPhrase:10,nearPhrase:8},saa_field_attachment:{exactPhrase:1,nearPhrase:.5}},nearPhraseSlop:2,stopWords:["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","as","is","was","are","been","be","have","has","had","do","does","did","will","would","should","could","may","might","must","can","this","that","these","those","it","its"],interestingness:{demoted:{max:10,weight:.1},deferred:{max:30,weight:.3},average:{max:50,weight:1},promoted:{max:75,weight:1.5},announced:{max:100,weight:3}},longevity:{today:{max:3,scale:1},days:{max:20,scale:5},week:{max:40,scale:10},month:{max:65,scale:45},year:{max:85,scale:365},longtime:{max:95,scale:3650},always:{max:100,scale:99999}},defaultLongevity:80},g={numberOfFragments:3,fragmentSize:350,preTags:["<em>"],postTags:["</em>"]},h={searchEndpoint:"https://www.undrr.org/search-endpoint",resultsPerPage:5,facetCountToShow:500,debounceDelay:300,minSearchLength:3,enableHashSync:"auto",defaultQuery:"",defaultSort:"relevance",showSearchBox:!0,showResultsCount:!0,showSearchTimer:!1,showFacets:!0,showActiveFilters:!0,showSearchMetrics:!1,showPager:!0,defaultFilters:[{key:"_language",value:"en"}],visibleFilters:null,allowedTypes:null,queryAppend:"",customFilters:[],customFacets:[]},f=new Map(l.map(e=>[e.id,e])),y=new Map(i.map(e=>[e.id,e])),_=new Map(c.map(e=>[e.id,e])),b=new Map(u.map(e=>[e.id,e])),x=new Map(Object.entries(o).flatMap(([e,t])=>t.options.map(a=>[`${t.field}:${a.id}`,{...a,field:t.field,parentType:e}]))),v=new Map(Object.entries(o).map(([e,t])=>[t.field,e]));function w(e){return y.get(e)}function j(e,t){return!t||!1!==t[e]}function k(e){const t=String(e);if(t.includes(":")){const e=x.get(t);if(e)return{field:e.field,value:e.id,label:e.name,isSubtype:!0,parentType:e.parentType};const[a,s]=t.split(":");return{field:a,value:s,label:s,isSubtype:!0,parentType:v.get(a)||null}}const a=y.get(t);return{field:"type",value:t,label:a?.name||t,isSubtype:!1,parentType:null}}function S(e,t){return`${e}:${t}`}var N=r(4848);const C={query:"",facets:{},facetOperators:{},customFacets:{},sortBy:"relevance",page:1,results:null,aggregations:null,totalResults:0,isLoading:!1,error:null,searchTime:null,isInitialized:!1},T="SET_QUERY",R="SET_FACET",L="REMOVE_FACET",P="CLEAR_FACETS",E="SET_FACET_OPERATOR",$="SET_CUSTOM_FACET",A="REMOVE_CUSTOM_FACET",F="SET_SORT",O="SET_PAGE",I="SET_RESULTS",M="SET_LOADING",q="SET_ERROR",D="INITIALIZE";function z(e,t){switch(t.type){case T:return{...e,query:t.payload,page:1};case R:{const{key:a,value:s,replace:r=!0}=t.payload,n=e.facets[a]||[],l=Array.isArray(s)?s:[s];let i;return i=r?l:[...new Set([...n,...l])],{...e,facets:{...e.facets,[a]:i},page:1}}case L:{const{key:a,value:s}=t.payload;if(void 0===s){const{[a]:t,...s}=e.facets,{[a]:r,...n}=e.facetOperators;return{...e,facets:s,facetOperators:n,page:1}}const r=(e.facets[a]||[]).filter(e=>e!==s);if(0===r.length){const{[a]:t,...s}=e.facets,{[a]:r,...n}=e.facetOperators;return{...e,facets:s,facetOperators:n,page:1}}return{...e,facets:{...e.facets,[a]:r},page:1}}case P:return{...e,facets:{},facetOperators:{},customFacets:{},page:1};case E:{const{key:a,operator:s}=t.payload;return{...e,facetOperators:{...e.facetOperators,[a]:s},page:1}}case $:{const{facetId:a,value:s}=t.payload,r=Array.isArray(s)?s:[s];return{...e,customFacets:{...e.customFacets,[a]:r},page:1}}case A:{const{facetId:a}=t.payload,{[a]:s,...r}=e.customFacets;return{...e,customFacets:r,page:1}}case F:return{...e,sortBy:t.payload,page:1};case O:return{...e,page:t.payload};case I:return{...e,results:t.payload.hits?.hits||[],aggregations:t.payload.aggregations||null,totalResults:t.payload.hits?.total?.value||0,searchTime:t.payload.took||null,isLoading:!1,error:null};case M:return{...e,isLoading:t.payload,error:t.payload?null:e.error};case q:return{...e,error:t.payload,isLoading:!1};case D:{const{defaultFilters:a=[],defaultQuery:s="",defaultSort:r="relevance"}=t.payload,n={};return a.forEach(e=>{e.key&&e.value&&(n[e.key]||(n[e.key]=[]),n[e.key].push(e.value))}),{...e,query:s,sortBy:r,facets:n,isInitialized:!0}}case"RESET":return{...C,isInitialized:!0};default:return e}}const W=(0,n.createContext)(null),B=(0,n.createContext)(null),U=(0,n.createContext)(null);function G({config:e,children:t}){const a=(0,n.useMemo)(()=>({...h,...e}),[e]),[s,r]=(0,n.useReducer)(z,C),l=(0,n.useMemo)(()=>s,[s]);return(0,N.jsx)(W.Provider,{value:a,children:(0,N.jsx)(B.Provider,{value:l,children:(0,N.jsx)(U.Provider,{value:r,children:t})})})}function K(){const e=(0,n.useContext)(W);if(null===e)throw new Error("useSearchConfig must be used within a SearchProvider");return e}function V(){const e=(0,n.useContext)(B);if(null===e)throw new Error("useSearchState must be used within a SearchProvider");return e}function H(){const e=(0,n.useContext)(U);if(null===e)throw new Error("useSearchDispatch must be used within a SearchProvider");return e}const Y=e=>({type:T,payload:e}),Q=(e,t,a=!0)=>({type:R,payload:{key:e,value:t,replace:a}}),J=(e,t)=>({type:L,payload:{key:e,value:t}}),Z=(e,t)=>({type:$,payload:{facetId:e,value:t}}),X=e=>({type:A,payload:{facetId:e}}),ee=e=>({type:O,payload:e});function te(e){switch(e){case"newest":return[{published_at:{order:"desc"}}];case"oldest":return[{published_at:{order:"asc"}}];default:return[{_score:{order:"desc"}}]}}function ae(e){const t=[];t.push({term:{status:"true"}});const a=e.customFilters||[];for(const e of a)e&&e.trim()&&t.push({query_string:{query:e.trim()}});return t}function se(e,t,a){const s=a.queryAppend||"",r=t.stopWords||[];let n=re(e||"");s&&(n=n?`${n} ${s}`:s);const l=t.fieldWeights;return n&&0!==n.length?{query_string:{query:le(ne(n,r)),fields:Object.entries(l).map(([e,t])=>`${e}^${t}`),default_operator:"AND",analyze_wildcard:!0}}:{query_string:{query:"*",analyze_wildcard:!0}}}function re(e){if(!e)return e;let t=e.trim();if((t.match(/"/g)||[]).length%2!=0){const e=t.lastIndexOf('"');t=t.slice(0,e)+t.slice(e+1)}return t=t.replace(/\s+(AND|OR|NOT)\s*$/i,""),t=t.replace(/^\s*(AND|OR|NOT)\s+/i,""),/^(AND|OR|NOT)$/i.test(t.trim())?"":(t=t.replace(/[\-\+]+$/,""),t.trim())}function ne(e,t=[]){if(!t||0===t.length||!e)return e;if(e.includes('"'))return e;const a=e.split(/\s+/).filter(e=>!t.includes(e.toLowerCase()));return a.length>0?a.join(" "):e}function le(e,t=1){return e.includes('"')||/[:~^/+\-!(){}[\]~*?:\\&|<>=@]/.test(e)?e:e.split(/\s+/).map(e=>`${e}~${t}`).join(" ")}function ie(e){return[oe(e),ce(e),ue(e),de(e)]}function oe(e){return{filter:{terms:{type:["landing"]}},weight:e.contentTypeBoosts?.landing||5}}function ce(e){return{filter:{terms:{type:["terminology"]}},weight:e.contentTypeBoosts?.terminology||1.5}}function ue(e){const t=e.longevity,a=e.defaultLongevity;return{script_score:{script:{source:"\n          double baseScale = 5000; // Default decay ~15 years\n\n          double longevity = (doc.containsKey('field_meta_longevity') && doc['field_meta_longevity'].size() > 0)\n                              ? doc['field_meta_longevity'].value\n                              : params.defaultLongevity;\n\n          if (longevity <= params.today) baseScale = params.todayScale;\n          else if (longevity <= params.days) baseScale = params.daysScale;\n          else if (longevity <= params.week) baseScale = params.weekScale;\n          else if (longevity <= params.month) baseScale = params.monthScale;\n          else if (longevity <= params.year) baseScale = params.yearScale;\n          else if (longevity <= params.longtime) baseScale = params.longtimeScale;\n          else baseScale = params.alwaysScale;\n\n          if (!doc.containsKey('published_at') || doc['published_at'].empty) return 1.0;\n          return Math.exp((doc['published_at'].value.toInstant().toEpochMilli() - params.now) / (baseScale * 86400000));\n        ",params:{now:Date.now(),defaultLongevity:a,today:t.today.max,todayScale:t.today.scale,days:t.days.max,daysScale:t.days.scale,week:t.week.max,weekScale:t.week.scale,month:t.month.max,monthScale:t.month.scale,year:t.year.max,yearScale:t.year.scale,longtime:t.longtime.max,longtimeScale:t.longtime.scale,alwaysScale:t.always.scale}}}}}function de(e){const t=e.interestingness;return{script_score:{script:{source:"\n          double interestingness = 1.0; // default\n          if (doc.containsKey('field_meta_interestingness') && doc['field_meta_interestingness'].size() > 0) {\n            double value = doc['field_meta_interestingness'].value;\n            if (value <= params.demoted) interestingness = params.demotedWeight;\n            else if (value <= params.deferred) interestingness = params.deferredWeight;\n            else if (value <= params.average) interestingness = params.averageWeight;\n            else if (value <= params.promoted) interestingness = params.promotedWeight;\n            else interestingness = params.announcedWeight;\n          }\n          return interestingness;\n        ",params:{demoted:t.demoted.max,demotedWeight:t.demoted.weight,deferred:t.deferred.max,deferredWeight:t.deferred.weight,average:t.average.max,averageWeight:t.average.weight,promoted:t.promoted.max,promotedWeight:t.promoted.weight,announcedWeight:t.announced.weight}}}}}function me(e){return{order:"desc",number_of_fragments:e.numberOfFragments,fragment_size:e.fragmentSize,fields:{body:{pre_tags:e.preTags,post_tags:e.postTags},title:{number_of_fragments:0}}}}function pe(e,t){const a={};for(const s of e)"year"!==s.key&&(a[s.key]={terms:{field:s.key,size:t}});return a.year={terms:{script:{source:"\n          if (doc.containsKey('published_at') && doc['published_at'].size() != 0) {\n            return doc['published_at'].value.getYear();\n          }\n        ",lang:"painless"},size:t}},a}function ge(){const e=K(),t=V(),a=H(),s=(0,n.useRef)(null),[r,l]=(0,n.useTransition)(),{query:i,facets:o,facetOperators:c,customFacets:u,sortBy:d,page:h,isInitialized:f}=t,{searchEndpoint:y,minSearchLength:_,debounceDelay:b}=e,x=(0,n.useCallback)(async(t={})=>{const{force:r=!1}=t,n=Object.keys(o).length>0||Object.keys(u||{}).length>0,f=0===i.length,b=i.length>0&&i.length<_;if(r||n||f||!b){s.current&&s.current.abort(),s.current=new AbortController,a({type:M,payload:!0});try{const t=function({query:e,facets:t,facetOperators:a,customFacets:s,sortBy:r,page:n=1},l){const i=l.scoring||p,o=l.highlight||g,c=l.resultsPerPage||50,u=l.facetCountToShow||500,d=l.facetFields||m,h=(n-1)*c,f=function(e,t,a){const s={must:se(e,t,a),filter:ae(a)},r=function(e,t){const a=[];if(!e||0===e.trim().length)return a;const s=t.phraseBoosts||{},r=t.nearPhraseSlop??2,n=t.stopWords||[],l=ne(function(e){return e?e.replace(/"/g,""):e}(re(e)),n);if(!l||0===l.trim().length)return a;const i=(e,t)=>{t&&(t.match&&a.push({match:{[e]:{query:l,boost:t.match}}}),t.exactPhrase&&a.push({match_phrase:{[e]:{query:l,slop:0,boost:t.exactPhrase}}}),t.nearPhrase&&a.push({match_phrase:{[e]:{query:l,slop:r,boost:t.nearPhrase}}}))};return i("teaser",s.teaser),i("title",s.title),i("body",s.body),i("saa_field_attachment",s.saa_field_attachment),a}(e,t);return r.length>0&&(s.should=r),{function_score:{query:{bool:s},functions:ie(t),score_mode:"multiply",boost_mode:"multiply"}}}(e,i,l),y=function(e,t,a,s){const r=[],n=function(e,t){const a=[],s=t.customFacets||[];if(0===s.length||!e)return a;for(const t of s){const s=e[t.id];if(!s||0===s.length)continue;const r=[];for(const e of s){const a=parseInt(e,10),s=t.options?.[a];s&&s.query&&s.query.trim()&&r.push(s.query.trim())}0!==r.length&&(1===r.length?a.push({query_string:{query:r[0]}}):a.push({bool:{should:r.map(e=>({query_string:{query:e}})),minimum_should_match:1}}))}return a}(a,s);r.push(...n);const l=s.customFacets||[],i=new Set(l.map(e=>e.id));for(const[a,s]of Object.entries(e)){if(!s||0===s.length)continue;if(i.has(a))continue;const e=t[a]||"OR";if("year"===a){const t=s.map(e=>parseInt(e,10));"AND"===e&&t.length>1?r.push({bool:{must:t.map(e=>({script:{script:{source:"\n                    if (doc.containsKey('published_at') && doc['published_at'].size() != 0) {\n                      return doc['published_at'].value.getYear() == params.year;\n                    }\n                    return false;\n                  ",lang:"painless",params:{year:e}}}}))}}):r.push({script:{script:{source:"\n                if (doc.containsKey('published_at') && doc['published_at'].size() != 0) {\n                  int docYear = doc['published_at'].value.getYear();\n                  for (int y : params.years) {\n                    if (docYear == y) return true;\n                  }\n                }\n                return false;\n              ",lang:"painless",params:{years:t}}}});continue}if("type"===a){const e={};for(const t of s){const a=k(t);e[a.field]||(e[a.field]=[]),e[a.field].push(a.value)}const t=[];for(const[a,s]of Object.entries(e))1===s.length?t.push({term:{[a]:s[0]}}):t.push({terms:{[a]:s}});1===t.length?r.push(t[0]):t.length>1&&r.push({bool:{should:t,minimum_should_match:1}});continue}1===s.length?r.push({term:{[a]:s[0]}}):"AND"===e?r.push({bool:{must:s.map(e=>({term:{[a]:e}}))}}):r.push({terms:{[a]:s}})}return 0===r.length?null:1===r.length?r[0]:{bool:{must:r}}}(t,a,s,l),_={from:h,size:c,sort:te(r),query:f,highlight:me(o),aggs:pe(d,u)};return y&&(_.post_filter=y),_}({query:i,facets:o,facetOperators:c,customFacets:u,sortBy:d,page:h},e),r=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:s.current.signal});if(!r.ok)throw new Error(`Search failed: ${r.status} ${r.statusText}`);const n=await r.json();l(()=>{a({type:I,payload:n})})}catch(e){if("AbortError"===e.name)return;console.error("Search error:",e),a((e=>({type:q,payload:e}))(e.message||"Search failed"))}}},[i,o,c,u,d,h,y,_,e,a,l]);(0,n.useEffect)(()=>{if(!f)return;const e=setTimeout(()=>{x()},b);return()=>{clearTimeout(e)}},[i,o,c,u,d,h,f,b,x]),(0,n.useEffect)(()=>()=>{s.current&&s.current.abort()},[]);const v=(0,n.useCallback)(()=>{x({force:!0})},[x]);return{executeSearch:x,isPending:r,refresh:v}}const he=function({value:e,onChange:t,isStale:a,isLoading:s,widgetId:r=""}){const l=K(),i=H(),o=(0,n.useId)(),c=r?`search-${r}`:o,{showSearchBox:u,minSearchLength:d}=l,m=(0,n.useCallback)(e=>{e.preventDefault()},[]),p=(0,n.useCallback)(e=>{t(e.target.value)},[t]),g=(0,n.useCallback)(()=>{t(""),i(Y(""))},[t,i]);return u?(0,N.jsxs)("form",{className:"mg-search__form",role:"search","aria-label":"Search content",onSubmit:m,"data-vf-google-analytics-region":"undrr-search-form",children:[(0,N.jsxs)("div",{className:"mg-search__input-wrapper",children:[(0,N.jsx)("label",{htmlFor:c,className:"mg-u-sr-only",children:"Search"}),(0,N.jsx)("input",{id:c,type:"search",className:"mg-search__input form-control",placeholder:"Search...",value:e,onChange:p,"aria-describedby":`${c}-hint`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false"}),(0,N.jsx)("span",{id:`${c}-hint`,className:"mg-u-sr-only",children:d>1?`Enter at least ${d} characters to search`:"Enter search terms"}),e&&(0,N.jsx)("button",{type:"button",className:"mg-search__clear",onClick:g,"aria-label":"Clear search",children:(0,N.jsx)("span",{"aria-hidden":"true",children:"×"})}),(s||a)&&(0,N.jsx)("span",{className:"mg-search__loading","aria-hidden":"true",title:"Searching..."})]}),(0,N.jsxs)("button",{type:"submit",className:"mg-search__submit btn btn-primary "+(s||a?"mg-search__submit--loading":""),"aria-label":s||a?"Searching...":"Submit search","aria-busy":s||a,children:[(0,N.jsx)("span",{className:"mg-search__submit-text",children:s||a?"Searching":"Search"}),(0,N.jsx)("span",{className:"mg-search__submit-icon","aria-hidden":"true",children:s||a?(0,N.jsx)("span",{className:"mg-search__submit-spinner"}):(0,N.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,N.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,N.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})]}):null},fe=function({hit:e,showMetrics:t=!1}){const a=e._source||{},s=e.highlight||{},{nid:r,title:l,url:i,type:o,field_domain_access:c,published_at:u,teaser:d}=a,m=Array.isArray(c)?c[0]:c,p=m?f.get(m):null,g=p?.url||"https://www.preventionweb.net";if(!m)return(0,N.jsxs)("article",{className:"mg-search__result mg-search__result--error",children:[t&&(0,N.jsxs)("span",{className:"mg-search__result-metrics",children:[(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Score: ",e._score?.toFixed(2)]}),void 0!==a.field_meta_interestingness?.[0]&&(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Int: ",a.field_meta_interestingness[0]]}),void 0!==a.field_meta_longevity?.[0]&&(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Long: ",a.field_meta_longevity[0]]})]}),(0,N.jsxs)("p",{className:"mg-search__result-error",children:["Content item ",r||"unknown"," has no assigned domain and cannot be shown."," ",(0,N.jsx)("a",{href:"https://www.undrr.org/contact-us",children:"Report this error"}),"."]})]});if(d){const s=p?p.url.replace("https://",""):m,r=function(e,t){return e&&t?("string"==typeof e?e:String(e)).replace(/href="\/([^"]*?)"/g,`href="${t}/$1"`).replace(/src="\/([^"]*?)"/g,`src="${t}/$1"`):e}(d,g);let n=r;const l=n.indexOf('<div class="field field--name-node-title');if(-1!==l){const e=`<p class="mg-search__result-site-name">${s}</p>`;n=n.slice(0,l)+e+n.slice(l)}return(0,N.jsxs)("article",{className:"mg-search__result","data-result-type":o,children:[t&&(0,N.jsxs)("span",{className:"mg-search__result-metrics",children:[(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Score: ",e._score?.toFixed(2)]}),void 0!==a.field_meta_interestingness?.[0]&&(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Int: ",a.field_meta_interestingness[0]]}),void 0!==a.field_meta_longevity?.[0]&&(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Long: ",a.field_meta_longevity[0]]})]}),(0,N.jsx)("div",{dangerouslySetInnerHTML:{__html:n}})]})}const h=s.title?.[0]||l,y=s.body?.join(" ... ")||"",_=(0,n.useMemo)(()=>{if(!u)return null;try{return new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return null}},[u]),b=w(o),x=b?.name||o,v=p?.name,j=(0,n.useMemo)(()=>!i&&r?`${g}/node/${r}`:i?i.startsWith("http")?i:`${g}${i}`:"#",[i,r,g]);return(0,N.jsxs)("article",{className:"mg-search__result","data-result-type":o,children:[t&&(0,N.jsxs)("span",{className:"mg-search__result-metrics",children:[(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Score: ",e._score?.toFixed(2)]}),void 0!==a.field_meta_interestingness?.[0]&&(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Int: ",a.field_meta_interestingness[0]]}),void 0!==a.field_meta_longevity?.[0]&&(0,N.jsxs)("span",{className:"mg-search__result-metric",children:["Long: ",a.field_meta_longevity[0]]})]}),(0,N.jsx)("div",{className:"mg-search__result-content",children:(0,N.jsxs)("div",{className:"mg-search__result-text",children:[(0,N.jsx)("h3",{className:"mg-search__result-title",children:(0,N.jsx)("a",{href:j,dangerouslySetInnerHTML:{__html:h}})}),(0,N.jsxs)("div",{className:"mg-search__result-meta",children:[x&&(0,N.jsx)("span",{className:"mg-search__result-type",children:x}),v&&(0,N.jsx)("span",{className:"mg-search__result-domain",children:v}),_&&(0,N.jsx)("time",{className:"mg-search__result-date",dateTime:u,children:_})]}),y&&(0,N.jsx)("p",{className:"mg-search__result-snippet",dangerouslySetInnerHTML:{__html:y}})]})})]})};var ye=r(2884);const _e=function({widgetId:e=""}){const{page:t,totalResults:a,isLoading:s}=V(),r=H(),{resultsPerPage:l}=K(),i=(0,n.useMemo)(()=>a&&0!==a?Math.ceil(a/l):0,[a,l]),o=(0,n.useCallback)(e=>{r(ee(e));const t=document.querySelector("[data-mg-search-widget]");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},[r]);return i<=1?null:(0,N.jsx)(ye.i,{page:t,totalPages:i,isLoading:s,onPageChange:o,ariaLabel:"Search results pagination"})};function be({count:e=3}){return(0,N.jsx)("div",{className:"mg-search__skeleton","aria-hidden":"true",children:Array.from({length:e}).map((e,t)=>(0,N.jsxs)("div",{className:"mg-search__skeleton-item",children:[(0,N.jsx)("div",{className:"mg-search__skeleton-title"}),(0,N.jsx)("div",{className:"mg-search__skeleton-meta"}),(0,N.jsx)("div",{className:"mg-search__skeleton-text"}),(0,N.jsx)("div",{className:"mg-search__skeleton-text mg-search__skeleton-text--short"})]},t))})}const xe=function({isStale:e=!1,widgetId:t="",showMobileFilterButton:a=!1,onOpenFilters:s,activeFilterCount:r=0}){const n=V(),l=K(),{results:i,totalResults:o,searchTime:c,isLoading:u,error:d,query:m,page:p,isInitialized:g}=n,{showResultsCount:h,showSearchTimer:f,showSearchMetrics:y,showPager:_,resultsPerPage:b,minSearchLength:x}=l;return g?d?(0,N.jsxs)("div",{className:"mg-search__results-error",role:"alert","aria-live":"assertive",children:[(0,N.jsxs)("p",{children:[(0,N.jsx)("strong",{children:"Search error:"})," ",d]}),(0,N.jsx)("p",{children:"Please try again or refine your search terms."})]}):u&&!i?(0,N.jsx)("div",{className:"mg-search__results-loading","aria-busy":"true","aria-live":"polite",children:(0,N.jsx)(be,{count:5})}):m||i&&0!==i.length?i&&0===i.length?(0,N.jsxs)("div",{className:"mg-search__results-empty",role:"status","aria-live":"polite",children:[(0,N.jsxs)("p",{children:["No results found for ",(0,N.jsxs)("strong",{children:['"',m,'"']}),"."]}),(0,N.jsx)("p",{children:"Try different search terms or adjust your filters."})]}):(0,N.jsxs)("div",{className:"mg-search__results","data-vf-google-analytics-region":"undrr-search-results",style:{opacity:e?.7:1,transition:"opacity 0.2s"},children:[(0,N.jsx)("div",{role:"status","aria-live":"polite","aria-atomic":"true",className:"mg-u-sr-only",children:!u&&null!==o&&(0,N.jsx)(N.Fragment,{children:0===o?"No results found"+(m?` for "${m}"`:""):`${o.toLocaleString()} result${1!==o?"s":""} found${m?` for "${m}"`:""}`})}),(0,N.jsxs)("div",{className:"mg-search__results-header",children:[h&&(0,N.jsxs)("p",{className:"mg-search__results-count",role:"status","aria-live":"polite",children:[(()=>{const e=(p-1)*b+1,t=Math.min(p*b,o||0);return(0,N.jsxs)(N.Fragment,{children:["Showing ",(0,N.jsx)("strong",{children:e.toLocaleString()}),"-",(0,N.jsx)("strong",{children:t.toLocaleString()})," of"," ",(0,N.jsx)("strong",{children:o?.toLocaleString()||0})," results"]})})(),m&&(0,N.jsxs)(N.Fragment,{children:[" ","for ",(0,N.jsxs)("strong",{children:['"',m,'"']})]}),f&&null!==c&&(0,N.jsxs)("span",{className:"mg-search__results-time",children:[" ","(",c,"ms)"]})]}),a&&s&&(0,N.jsxs)("button",{type:"button",className:"mg-search__filter-btn",onClick:s,"aria-label":r>0?`Filters, ${r} active`:"Filters",children:[(0,N.jsx)("svg",{className:"mg-search__filter-btn-icon",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,N.jsx)("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),(0,N.jsx)("span",{children:"Filters"}),r>0&&(0,N.jsx)("span",{className:"mg-search__filter-btn-badge",children:r})]})]}),(0,N.jsx)("div",{className:"mg-search__results-list",role:"list","aria-label":"Search results",children:i?.map((e,t)=>(0,N.jsx)("div",{role:"listitem",children:(0,N.jsx)(fe,{hit:e,showMetrics:y})},e._id||t))}),_&&(0,N.jsx)(_e,{widgetId:t})]}):(0,N.jsxs)("div",{className:"mg-search__results-empty",children:[(0,N.jsx)("p",{children:"Enter a search term to find content."}),x>1&&(0,N.jsxs)("p",{className:"mg-search__results-hint",children:["Minimum ",x," characters required."]})]}):(0,N.jsx)("div",{className:"mg-search__results-placeholder",children:(0,N.jsx)("p",{children:"Initializing search..."})})};function ve(){const[e,t]=(0,n.useState)({terms:null,news_type:c,type:i,languages:u,field_domain_access:l}),[a,s]=(0,n.useState)(!0),[r,o]=(0,n.useState)(null),d=(0,n.useRef)(null),m=(0,n.useCallback)(async()=>{d.current&&d.current.abort(),d.current=new AbortController,s(!0),o(null);try{const e=await fetch("https://www.preventionweb.net/api/v1/taxonomy?vid=news_type,prevention_web_regions,hazard,theme&items_per_page=1000&langcode=en",{signal:d.current.signal});if(!e.ok)throw new Error(`Taxonomy fetch failed: ${e.status}`);const a=(await e.json()).results||[];t(e=>({...e,terms:a}))}catch(e){if("AbortError"===e.name)return;console.error("useTaxonomies: Failed to fetch taxonomies:",e),o(e.message)}finally{s(!1)}},[]);(0,n.useEffect)(()=>(m(),()=>{d.current&&d.current.abort()}),[m]);const p=(0,n.useCallback)((t,a,s)=>{const r=String(a);if("year"===t)return r;if("field_domain_access"===s||"field_domain_access"===t){const e=f.get(r);return e?e.name:r}if("type"===s||"type"===t)return k(r).label;if("languages"===s||"_language"===t){const e=b.get(r);return e?e.name:r}if("field_news_type"===t){const e=_.get(r);if(e)return e.name}if(e.terms){const t=e.terms.find(e=>String(e.id)===r);if(t)return t.name}return r},[e.terms]),g=(0,n.useCallback)(e=>{const t=f.get(e);return t?t.url:"https://www.preventionweb.net"},[]);return{taxonomies:e,isLoading:a,error:r,getLabel:p,getDomainUrl:g,refresh:m}}function we(e,t,a,s){if("year"===e)return String(t);switch(a){case"field_domain_access":{const e=(n=t,f.get(n));return e?.name||t}case"type":{const e=k(t);if(e.isSubtype&&e.parentType){const t=w(e.parentType);if(t)return`${t.name}: ${e.label}`}return e.label}case"languages":{const e=(r=t,b.get(r));return e?.name||t}default:return s?s(e,t,a):t}var r,n}const je=function(){const e=V(),t=K(),a=H(),s=(0,n.useId)(),{getLabel:r}=ve(),{facets:l,facetOperators:i,customFacets:o}=e,{showActiveFilters:c,visibleFilters:u,defaultFilters:d,customFacets:p,facetFields:g}=t,h=(0,n.useMemo)(()=>{const e=[];for(const[t,a]of Object.entries(l)){if(!a||0===a.length)continue;const s=(g||m).find(e=>e.key===t);if(!s)continue;if(!j(t,u))continue;const n=d?.find(e=>e.key===t);if(n&&1===a.length&&a[0]===n.value)continue;const l=i[t]||"OR";for(let n=0;n<a.length;n++){const i=a[n],o=we(t,i,s.vocabulary,r);e.push({key:t,value:i,label:o,fieldLabel:s.label,isCustomFacet:!1,operator:l,isFirstInGroup:0===n,isLastInGroup:n===a.length-1,groupSize:a.length})}}if(o&&p)for(const[t,a]of Object.entries(o)){if(!a||0===a.length)continue;const s=p.find(e=>e.id===t);if(s)for(const r of a){const a=parseInt(r,10),n=s.options?.[a];n&&e.push({key:t,value:r,label:n.label,fieldLabel:s.title,isCustomFacet:!0})}}return e},[l,i,o,g,u,d,p,r]),f=(0,n.useCallback)(e=>{e.isCustomFacet?a(X(e.key)):a(J(e.key,e.value))},[a]),y=(0,n.useCallback)(()=>{a({type:P})},[a]);return c&&0!==h.length?(0,N.jsxs)("div",{className:"mg-search__active-filters",role:"region","aria-label":"Active filters",children:[(0,N.jsx)("span",{className:"mg-search__active-filters-label",id:s,children:"Filtered by:"}),(0,N.jsx)("ul",{className:"mg-search__active-filters-list","aria-labelledby":s,role:"list",children:h.map((e,t)=>(0,N.jsxs)("li",{role:"listitem",children:["AND"===e.operator&&e.groupSize>1&&!e.isFirstInGroup&&(0,N.jsx)("span",{className:"mg-search__filter-chip-connector","aria-hidden":"true",children:"and"}),(0,N.jsxs)("button",{type:"button",className:"mg-search__filter-chip",onClick:()=>f(e),"aria-label":`Remove filter: ${e.fieldLabel} is ${e.label}`,children:[(0,N.jsx)("span",{className:"mg-search__filter-chip-label",children:e.label}),(0,N.jsx)("span",{className:"mg-search__filter-chip-remove","aria-hidden":"true",children:"×"})]})]},`${e.key}-${e.value}-${t}`))}),h.length>1&&(0,N.jsx)("button",{type:"button",className:"mg-search__clear-all",onClick:y,"aria-label":`Clear all ${h.length} active filters`,children:"Clear all filters"}),(0,N.jsxs)("span",{className:"mg-u-sr-only",role:"status","aria-live":"polite",children:[h.length," active filter",1!==h.length?"s":""]})]}):null},ke=[{value:"relevance",label:"Relevance"},{value:"newest",label:"Newest"},{value:"oldest",label:"Oldest"}],Se=function({widgetId:e="search"}){const{sortBy:t}=V(),a=H(),s=e=>{a((e=>({type:F,payload:e}))(e.target.value))};return(0,N.jsxs)("fieldset",{className:"mg-search__sort",children:[(0,N.jsx)("legend",{id:`sort-heading-${e}`,children:"Sort"}),ke.map(a=>(0,N.jsxs)("div",{className:"mg-search__sort-option",children:[(0,N.jsx)("input",{type:"radio",name:`sort-${e}`,value:a.value,id:`sort-${a.value}-${e}`,checked:t===a.value,onChange:s}),(0,N.jsx)("label",{htmlFor:`sort-${a.value}-${e}`,children:a.label})]},a.value))]})};function Ne({id:e,label:a,placeholder:s="Select...",options:r=[],value:l=[],onChange:i,multiple:o=!1,searchThreshold:c=8}){const[u,d]=(0,n.useState)(!1),[m,p]=(0,n.useState)(""),[g,h]=(0,n.useState)(-1),f=(0,n.useRef)(null),y=(0,n.useRef)(null),_=(0,n.useRef)(null),b=(0,n.useRef)(null),x=(0,n.useId)(),v=e||x,w=`${v}-listbox`,j=(0,n.useCallback)(e=>`${v}-option-${e}`,[v]),k=u&&g>=0?j(g):void 0,S=(0,n.useMemo)(()=>Array.isArray(l)?l:null==l||""===l?[]:[l],[l]),C=(0,n.useMemo)(()=>{if(!m.trim())return r;const e=m.toLowerCase();return r.filter(t=>t.label.toLowerCase().includes(e))},[r,m]),T=r.length>c,R=(0,n.useMemo)(()=>{if(0===S.length)return s;if(1===S.length){const e=r.find(e=>e.value===S[0]);return e?.label||S[0]}return`${S.length} selected`},[S,r,s]),L=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),d(!1),p(""),y.current?.focus()},[]);(0,n.useEffect)(()=>{u&&T&&_.current&&_.current.focus()},[u,T]),(0,n.useEffect)(()=>{h(-1)},[C.length]);const P=(0,n.useCallback)(e=>{if(o){const t=S.includes(e)?S.filter(t=>t!==e):[...S,e];i(t)}else i(e),d(!1),p(""),y.current?.focus()},[o,S,i]),E=(0,n.useCallback)(e=>{if(u)switch(e.key){case"Escape":e.preventDefault(),d(!1),p(""),y.current?.focus();break;case"ArrowDown":e.preventDefault(),h(e=>e<C.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),h(e=>e>0?e-1:C.length-1);break;case"Enter":case" ":e.preventDefault(),g>=0&&C[g]&&P(C[g].value);break;case"Tab":d(!1),p("")}else"Enter"!==e.key&&" "!==e.key&&"ArrowDown"!==e.key||(e.preventDefault(),d(!0))},[u,g,C,P]);(0,n.useEffect)(()=>{if(g>=0&&b.current){const e=b.current.children[g];e&&e.scrollIntoView({block:"nearest"})}},[g]);const $=(0,n.useCallback)(()=>{d(e=>!e),u&&p("")},[u]),A=(0,n.useCallback)(e=>{p(e.target.value),h(0)},[]),F=(0,n.useCallback)(e=>S.includes(e),[S]);return(0,N.jsxs)("div",{ref:f,className:"mg-select "+(u?"mg-select--open":""),onKeyDown:E,children:[(0,N.jsxs)("button",{ref:y,type:"button",id:v,className:"mg-select__trigger","aria-haspopup":"listbox","aria-expanded":u,"aria-labelledby":`${v}-label`,"aria-controls":w,"aria-activedescendant":k,onClick:$,children:[(0,N.jsx)("span",{className:"mg-select__trigger-text",children:R}),(0,N.jsx)("span",{className:"mg-select__trigger-icon","aria-hidden":"true",children:(0,N.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,N.jsx)("path",{d:"M3 4.5L6 7.5L9 4.5"})})})]}),u&&t((0,N.jsx)("div",{className:"mg-select__backdrop",onClick:L,onMouseDown:L,"aria-hidden":"true"}),document.body),u&&(0,N.jsxs)("div",{className:"mg-select__dropdown",role:"presentation",children:[T&&(0,N.jsx)("div",{className:"mg-select__search",children:(0,N.jsx)("input",{ref:_,type:"text",className:"mg-select__search-input",placeholder:"Search...",value:m,onChange:A,"aria-label":`Search ${a}`,autoComplete:"off"})}),(0,N.jsx)("ul",{ref:b,id:w,className:"mg-select__list",role:"listbox","aria-label":a,"aria-multiselectable":o,children:0===C.length?(0,N.jsx)("li",{className:"mg-select__empty",children:"No options found"}):C.map((e,t)=>(0,N.jsxs)("li",{id:j(t),className:`mg-select__option ${F(e.value)?"mg-select__option--selected":""} ${t===g?"mg-select__option--highlighted":""} ${e.isSubtype&&!F(e.value)?"mg-select__option--subtype":""}`,role:"option","aria-selected":F(e.value),onClick:()=>P(e.value),onMouseEnter:()=>h(t),children:[(0,N.jsx)("span",{className:"mg-select__indicator "+(o?"mg-select__indicator--checkbox":"mg-select__indicator--radio"),"aria-hidden":"true",children:F(e.value)&&(o?(0,N.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",children:(0,N.jsx)("path",{d:"M10 3L4.5 8.5L2 6",stroke:"currentColor",strokeWidth:"2",fill:"none"})}):(0,N.jsx)("span",{className:"mg-select__indicator-dot"}))}),(0,N.jsx)("span",{className:"mg-select__option-label",children:e.label}),void 0!==e.count&&(0,N.jsx)("span",{className:"mg-select__option-count",children:e.count.toLocaleString()})]},e.value))})]})]})}const Ce=function({field:e,buckets:t=[],getLabel:a,widgetId:s="search",allowedTypes:r=null}){const{facets:l,facetOperators:i}=V(),o=H(),{key:c,label:u,vocabulary:m,type:p}=e,g="select-multiple"===p,h=l[c]||[],f=g&&h.length>=2&&!d.includes(c),y=i[c]||"OR",_=(0,n.useCallback)(e=>{o(((e,t)=>({type:E,payload:{key:e,operator:t}}))(c,e))},[o,c]),b=(0,n.useMemo)(()=>{const e="type"===c,s=t.filter(t=>{if(e&&r){const e=String(t.key);if(t.isSubtype&&t.parentType){if(Array.isArray(r))return r.includes(t.parentType);if("object"==typeof r&&r.types)return r.types.includes(t.parentType)}if(Array.isArray(r))return r.includes(e);if("object"==typeof r&&r.types)return r.types.includes(e)}return!0}).map(t=>{const s=String(t.key),r=h.includes(s);let n,l=!1,i=t.parentType||null;if(e){const e=k(s);if(n=e.label,l=e.isSubtype,i=e.parentType||i,l&&r&&i){const e=w(i);e&&(n=`${e.name}: ${n}`)}}else n=a(c,t.key,m);return"DISABLED"===n?null:{value:s,label:n,count:t.doc_count,isSelected:r,isSubtype:l||t.isSubtype||!1,parentType:i}}).filter(Boolean),n=new Set(s.map(e=>e.value)),l=h.filter(e=>!n.has(e)).map(t=>{let s,r=!1,n=null;if(e){const e=k(t);if(s=e.label,r=e.isSubtype,n=e.parentType,r&&n){const e=w(n);e&&(s=`${e.name}: ${s}`)}}else s=a(c,t,m);return{value:t,label:s,count:0,isSelected:!0,isSubtype:r,parentType:n}}),i=[...s,...l];return e?i.sort((e,t)=>e.isSelected&&!t.isSelected?-1:!e.isSelected&&t.isSelected?1:0):i.sort((e,t)=>e.isSelected&&!t.isSelected?-1:!e.isSelected&&t.isSelected?1:t.count-e.count)},[t,c,m,a,r,h]),x=(0,n.useCallback)(e=>{if(g){const t=Array.isArray(e)?e:[e];0===t.length?o(J(c)):o(Q(c,t,!0))}else o(null==e||""===e?J(c):Q(c,e,!0))},[o,c,g]);if(0===b.length)return null;const v=`facet-${c}-${s}`;return(0,N.jsxs)("fieldset",{className:"mg-search__facet","data-facet-key":c,children:[(0,N.jsx)("legend",{id:`${v}-label`,children:u}),(0,N.jsx)(Ne,{id:v,label:u,placeholder:`Select ${u.toLowerCase()}`,options:b,value:g?h:h[0]||"",onChange:x,multiple:g,searchThreshold:8}),f&&(0,N.jsxs)("div",{className:"mg-search__facet-operator",children:[(0,N.jsxs)("div",{className:"mg-search__facet-operator-row",children:[(0,N.jsx)("span",{className:"mg-search__facet-operator-label",children:"Match:"}),(0,N.jsxs)("div",{className:"mg-search__facet-operator-toggle",role:"radiogroup","aria-label":`Match mode for ${u}`,children:[(0,N.jsxs)("label",{className:"mg-search__facet-operator-option "+("OR"===y?"mg-search__facet-operator-option--active":""),children:[(0,N.jsx)("input",{type:"radio",name:`${c}-operator`,value:"OR",checked:"OR"===y,onChange:()=>_("OR")}),(0,N.jsx)("span",{children:"Any of these"})]}),(0,N.jsxs)("label",{className:"mg-search__facet-operator-option "+("AND"===y?"mg-search__facet-operator-option--active":""),children:[(0,N.jsx)("input",{type:"radio",name:`${c}-operator`,value:"AND",checked:"AND"===y,onChange:()=>_("AND")}),(0,N.jsx)("span",{children:"All of these"})]})]})]}),(0,N.jsx)("p",{className:"mg-search__facet-operator-hint",children:"OR"===y?`Results include any of the ${h.length} selected`:`Results must match all ${h.length} selected`})]})]})},Te=function({facet:e,widgetId:t="search"}){const{customFacets:a}=V(),s=H(),{id:r,title:l,options:i=[],multiSelect:o=!1}=e,c=a?.[r]||[],u=(0,n.useMemo)(()=>i.map((e,t)=>e.label?{value:String(t),label:e.label}:null).filter(Boolean),[i]),d=(0,n.useCallback)(e=>{if(o){const t=Array.isArray(e)?e:[e];0===t.length?s(X(r)):s(Z(r,t))}else s(e&&""!==e?Z(r,[e]):X(r))},[s,r,o]);if(!i||0===i.length)return null;const m=`custom-facet-${r}-${t}`;return(0,N.jsxs)("fieldset",{className:"mg-search__facet mg-search__facet--custom","data-custom-facet":r,children:[(0,N.jsx)("legend",{id:`${m}-label`,children:l}),(0,N.jsx)(Ne,{id:m,label:l,placeholder:`Select ${l.toLowerCase()}`,options:u,value:o?c:c[0]||"",onChange:d,multiple:o,searchThreshold:8})]})},Re=function({widgetId:e="search"}){const t=K(),{aggregations:a}=V(),{getLabel:s,isLoading:r}=ve(),{visibleFilters:l,allowedTypes:i,customFacets:c=[],facetFields:u}=t,d=u||m,p=(0,n.useMemo)(()=>{if(!a)return[];const e=a.type?.buckets||[],t=[];for(const s of e){t.push({...s,isSubtype:!1,parentType:null});const e=o[s.key];if(e){const r=[...a[e.field]?.buckets||[]].sort((e,t)=>t.doc_count-e.doc_count);for(const a of r)t.push({key:S(e.field,a.key),doc_count:a.doc_count,isSubtype:!0,parentType:s.key})}}return t},[a]),g=(0,n.useMemo)(()=>new Set(Object.values(o).map(e=>e.field)),[]),h=(0,n.useMemo)(()=>d.filter(e=>!!j(e.key,l)&&!g.has(e.key)).map(t=>{if("type"===t.key)return(0,N.jsx)(Ce,{field:t,buckets:p,getLabel:s,widgetId:e,allowedTypes:i},t.key);const r=a?.[t.key]?.buckets||[];return(0,N.jsx)(Ce,{field:t,buckets:r,getLabel:s,widgetId:e,allowedTypes:i},t.key)}),[d,a,l,i,g,p,s,e]),f=(0,n.useMemo)(()=>c&&0!==c.length?[...c].sort((e,t)=>(e.weight||50)-(t.weight||50)).map(t=>(0,N.jsx)(Te,{facet:t,widgetId:e},t.id)):null,[c,e]);return(0,N.jsxs)("div",{className:"mg-search__facets","data-mg-search-facets":!0,children:[(0,N.jsx)(Se,{widgetId:e}),r&&(0,N.jsx)("div",{className:"mg-search__facets-loading","aria-live":"polite",children:"Loading filters..."}),(0,N.jsxs)("div",{className:"mg-search__facet-containers",children:[f,h]})]})},Le=function({isOpen:e,onClose:t,widgetId:a="search"}){const s=(0,n.useRef)(null),r=(0,n.useRef)(null),l=function(e){let t=0;if(e.facets)for(const a of Object.values(e.facets))Array.isArray(a)&&(t+=a.length);if(e.customFacets)for(const a of Object.values(e.customFacets))Array.isArray(a)&&(t+=a.length);return t}(V());(0,n.useEffect)(()=>{if(e){const e=document.body.style.overflow,t=document.body.style.paddingRight,a=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",a>0&&(document.body.style.paddingRight=`${a}px`),()=>{document.body.style.overflow=e,document.body.style.paddingRight=t}}},[e]),(0,n.useEffect)(()=>{e&&r.current&&requestAnimationFrame(()=>{r.current?.focus()})},[e]),(0,n.useEffect)(()=>{if(!e)return;const a=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,t]);const i=(0,n.useCallback)(e=>{if("Tab"!==e.key||!s.current)return;const t=s.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),a=t[0],r=t[t.length-1];e.shiftKey&&document.activeElement===a?(e.preventDefault(),r?.focus()):e.shiftKey||document.activeElement!==r||(e.preventDefault(),a?.focus())},[]),o=(0,n.useCallback)(e=>{e.target===e.currentTarget&&t()},[t]);return e?(0,N.jsx)("div",{className:"mg-search__drawer-backdrop",onClick:o,role:"presentation",children:(0,N.jsxs)("div",{ref:s,className:"mg-search__drawer",role:"dialog","aria-modal":"true","aria-labelledby":`${a}-drawer-title`,onKeyDown:i,children:[(0,N.jsxs)("header",{className:"mg-search__drawer-header",children:[(0,N.jsxs)("h2",{id:`${a}-drawer-title`,className:"mg-search__drawer-title",children:["Filters",l>0&&(0,N.jsx)("span",{className:"mg-search__drawer-count",children:l})]}),(0,N.jsx)("button",{ref:r,type:"button",className:"mg-search__drawer-close",onClick:t,"aria-label":"Close filters",children:(0,N.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,N.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,N.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,N.jsx)("div",{className:"mg-search__drawer-content",children:(0,N.jsx)(Re,{widgetId:a})}),(0,N.jsx)("footer",{className:"mg-search__drawer-footer",children:(0,N.jsxs)("button",{type:"button",className:"mg-search__drawer-apply",onClick:t,children:["View results",l>0&&(0,N.jsxs)("span",{className:"mg-search__drawer-apply-count",children:["(",l," filter",1!==l?"s":""," applied)"]})]})})]})}):null};function Pe({config:e}){return(0,N.jsx)(G,{config:e,children:(0,N.jsx)($e,{})})}const Ee=Pe;function $e(){const e=K(),t=V(),a=H(),{isPending:s}=ge(),r=(0,n.useId)().replace(/:/g,"");!function({enabled:e=!0}={}){const t=K(),a=V(),s=H(),r=(0,n.useRef)(!1),l=(0,n.useRef)(""),{query:i,page:o,isInitialized:c}=a,{enableHashSync:u}=t,d=e&&(!0===u||"auto"===u&&"undefined"!=typeof window),m=(0,n.useCallback)(()=>{if("undefined"==typeof window)return{};const e=window.location.hash.substring(1);if(!e)return{};const t=new URLSearchParams(e),a=t.get("page");return{query:t.get("query"),page:a?parseInt(a,10):null,label:t.get("label")}},[]),p=(0,n.useCallback)((e,t)=>{if(!d||"undefined"==typeof window)return;const a=new URLSearchParams;e&&a.set("query",e),t&&t>1&&a.set("page",t.toString());const s=a.toString();s!==l.current&&(l.current=s,s?window.history.replaceState(null,"",`#${s}`):window.history.replaceState(null,"",window.location.pathname+window.location.search))},[d]);(0,n.useEffect)(()=>{if(!d||"undefined"==typeof window||r.current)return;const e=new URLSearchParams(window.location.search).get("text");if(e){const t=`query=${encodeURIComponent(e)}`,a=window.location.origin+window.location.pathname+"#"+t;return window.history.replaceState(null,"",a),s(Y(e)),l.current=t,void(r.current=!0)}const t=m();if(t.query){const e=decodeURIComponent(t.query);if(s(Y(e)),t.label&&"undefined"!=typeof document){const e=document.querySelector("h1");e&&(e.textContent=decodeURIComponent(t.label))}}t.page&&t.page>1&&s(ee(t.page)),l.current=window.location.hash.substring(1),r.current=!0},[d,s,m]),(0,n.useEffect)(()=>{d&&c&&p(i,o)},[d,c,i,o,p]),(0,n.useEffect)(()=>{if(!d||"undefined"==typeof window)return;const e=()=>{const e=m(),t=window.location.hash.substring(1);if(t===l.current)return;if(l.current=t,void 0!==e.query){const t=decodeURIComponent(e.query||"");t!==i&&s(Y(t))}const a=e.page||1;a!==o&&s(ee(a))};return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[d,i,o,s,m])}({enabled:!1!==e.enableHashSync});const[l,i]=(0,n.useState)(e.defaultQuery||""),[o,c]=(0,n.useState)(!1),u=(0,n.useCallback)(()=>c(!0),[]),d=(0,n.useCallback)(()=>c(!1),[]),m=(0,n.useDeferredValue)(l),p=l!==m;(0,n.useEffect)(()=>{a(Y(m))},[m,a]),(0,n.useEffect)(()=>{a((e=>({type:D,payload:e}))({defaultFilters:e.defaultFilters,defaultQuery:e.defaultQuery,defaultSort:e.defaultSort}))},[a,e.defaultFilters,e.defaultQuery,e.defaultSort]),(0,n.useEffect)(()=>{t.query!==l&&t.isInitialized&&i(t.query)},[t.query,t.isInitialized]);const{showFacets:g,showActiveFilters:h,showSearchMetrics:f}=e,{isLoading:y}=t,_=function(e){let t=0;if(e.facets)for(const a of Object.values(e.facets))Array.isArray(a)&&(t+=a.length);if(e.customFacets)for(const a of Object.values(e.customFacets))Array.isArray(a)&&(t+=a.length);return t}(t);return(0,N.jsxs)("div",{className:"mg-search-widget "+(y||s?"mg-search-widget--loading":""),"data-mg-search-widget":!0,"data-mg-search-debug":f?"true":void 0,children:[(y||s||p)&&(0,N.jsx)("div",{className:"mg-search__progress","aria-hidden":"true",children:(0,N.jsx)("div",{className:"mg-search__progress-bar"})}),!1!==e.showSearchBox&&(0,N.jsx)(he,{value:l,onChange:i,isStale:p||s,isLoading:y,widgetId:r}),h&&(0,N.jsx)(je,{widgetId:r}),(0,N.jsxs)("div",{className:"mg-search__content",children:[(0,N.jsx)("main",{className:"mg-search__main "+(p||s?"mg-search__main--stale":""),"data-vf-google-analytics-region":"undrr-search-results","aria-busy":y||s,children:(0,N.jsx)(n.Suspense,{fallback:(0,N.jsx)(Ae,{}),children:(0,N.jsx)(xe,{isStale:p||s,widgetId:r,showMobileFilterButton:g,onOpenFilters:u,activeFilterCount:_})})}),g&&(0,N.jsx)("aside",{className:"mg-search__sidebar","data-vf-google-analytics-region":"undrr-search-facets",children:(0,N.jsx)(Re,{widgetId:r})})]}),g&&(0,N.jsx)(Le,{isOpen:o,onClose:d,widgetId:r})]})}function Ae(){return(0,N.jsx)("div",{className:"mg-search__skeleton","aria-busy":"true","aria-label":"Loading results",children:[1,2,3,4,5].map(e=>(0,N.jsxs)("div",{className:"mg-search__skeleton-item",children:[(0,N.jsx)("div",{className:"mg-search__skeleton-title"}),(0,N.jsx)("div",{className:"mg-search__skeleton-meta"}),(0,N.jsx)("div",{className:"mg-search__skeleton-text"}),(0,N.jsx)("div",{className:"mg-search__skeleton-text mg-search__skeleton-text--short"})]},e))})}const Fe=Ee;export{Ee as SearchWidget,Pe as SyndicationSearchWidget,Fe as default};