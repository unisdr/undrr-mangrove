import { Meta, Story, Canvas } from '@storybook/addon-docs/blocks';
import { Gallery } from './Gallery';
import * as GalleryStories from './Gallery.stories';

<Meta of={GalleryStories} />

# Gallery

An accessible, responsive gallery component for images, videos, embeds, and custom HTML content.

## Overview

The Gallery component displays a collection of media items with thumbnail navigation on the left (desktop) or bottom (mobile). Users can navigate through items by clicking thumbnails, using navigation arrows, or with keyboard controls.

### Key features

- **Multiple media types**: Images, videos, embeds (YouTube, Vimeo), and custom HTML
- **Thumbnail navigation**: Clickable thumbnails on left or bottom
- **Keyboard navigation**: Arrow keys, Home, End support
- **Responsive design**: Adapts from desktop to mobile seamlessly
- **Flexible layout**: Handles various aspect ratios gracefully
- **Accessible**: Full ARIA support and screen reader friendly
- **Optional descriptions**: Display titles and captions below content
- **Customizable**: Control visibility of thumbnails, arrows, and descriptions

## Basic usage

<Canvas of={GalleryStories.BasicGallery} />

The default gallery layout with thumbnails on the left, navigation arrows, and descriptions.

## Thumbnail positions

### Thumbnails on left (default)

<Canvas of={GalleryStories.BasicGallery} />

Best for desktop viewing with vertical thumbnail scrolling.

### Thumbnails at bottom

<Canvas of={GalleryStories.ThumbnailsBottom} />

Alternative layout with thumbnails below the main image.

## Scrolling with many images

<Canvas of={GalleryStories.ManyImages} />

When there are many images, the thumbnail list becomes scrollable. Selected thumbnails automatically scroll into view.

## Configuration options

### Without thumbnails

<Canvas of={GalleryStories.WithoutThumbnails} />

Show only the main image with arrow navigation.

### Without arrows

<Canvas of={GalleryStories.WithoutArrows} />

Navigate only via thumbnail clicks or keyboard.

### Without descriptions

<Canvas of={GalleryStories.WithoutDescriptions} />

Show images without titles or captions.

### Minimal configuration

<Canvas of={GalleryStories.Minimal} />

Simplest gallery with only essential features.

## Handling different image dimensions

<Canvas of={GalleryStories.MixedAspectRatios} />

The gallery handles landscape, portrait, square, and panoramic images gracefully. Images use `object-fit: contain` to preserve their aspect ratios, with a neutral background filling empty space.

## Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `media` | array | *required* | Array of media items (see Media item object below) |
| `initialIndex` | number | `0` | Index of the initially displayed image |
| `showThumbnails` | boolean | `true` | Show/hide thumbnail list |
| `thumbnailPosition` | string | `'left'` | Position of thumbnails: `'left'` or `'bottom'` |
| `showArrows` | boolean | `true` | Show/hide navigation arrows |
| `showDescription` | boolean | `true` | Show/hide image titles and captions |
| `enableKeyboard` | boolean | `true` | Enable/disable keyboard navigation |
| `loop` | boolean | `false` | Enable infinite loop navigation |
| `arrowStyle` | string | `'overlay'` | Arrow style: `'overlay'` or `'corner'` |
| `onMediaChange` | function | `undefined` | Callback when media item changes: `(index, item) => {}` |

### Media item object

Each item in the `media` array should have:

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier for the item |
| `type` | string | No | Media type: `'image'` (default), `'video'`, `'embed'`, or `'html'` |
| `src` | string | Conditional | Source URL for image or video (required for image/video types) |
| `alt` | string | Conditional | Alternative text for accessibility (required for image/video types) |
| `title` | string | No | Title displayed below main content |
| `description` | string | No | Description/caption text |
| `thumbnail` | string | No | Thumbnail image URL (falls back to `src` for images) |
| `poster` | string | No | Video poster image (video type only) |
| `embedUrl` | string | No | Embed source URL (embed type only, falls back to `src`) |
| `html` | string | Conditional | Raw HTML content (required for html type) |

### Security note for HTML content

When using `type: 'html'`, the content is rendered using React's `dangerouslySetInnerHTML`. **You must sanitize any user-generated HTML before passing it to the gallery.** Use a library like [DOMPurify](https://github.com/cure53/DOMPurify) to prevent XSS attacks:

```jsx
import DOMPurify from 'dompurify';

const sanitizedHtml = DOMPurify.sanitize(userProvidedHtml);
const item = { id: '1', type: 'html', html: sanitizedHtml };
```

## Keyboard navigation

The gallery supports keyboard navigation when `enableKeyboard` is enabled:

- **Left Arrow** - Navigate to previous image
- **Right Arrow** - Navigate to next image
- **Home** - Jump to first image
- **End** - Jump to last image
- **Tab** - Navigate through thumbnails
- **Enter/Space** - Select focused thumbnail

## Accessibility

The component follows WAI-ARIA best practices:

- **ARIA roles**: `region`, `group`, `tablist`, `tab`
- **ARIA attributes**: `aria-label`, `aria-selected`, `aria-current`, `aria-describedby`
- **Keyboard navigation**: Full keyboard support
- **Focus management**: Clear focus indicators and focus scrolling
- **Alt text**: Required for all images
- **Screen reader support**: Announces current image and navigation options

## Responsive behavior

**Desktop (≥ 768px):**
- Thumbnails displayed vertically on the left
- Main image takes remaining space
- Description below main image
- Arrows visible on hover

**Mobile (< 768px):**
- Vertical stack: Main image → Description → Thumbnails
- Thumbnails scroll horizontally
- Arrows always visible (smaller size)

**Thumbnail Position Bottom:**
- Same responsive behavior, but thumbnails always at bottom

## Usage example

```jsx
import { Gallery } from './Gallery';

const myMedia = [
  {
    id: '1',
    src: '/images/photo1.jpg',
    alt: 'Mountain landscape',
    title: 'Mountain View',
    description: 'Beautiful mountain scenery at sunrise.',
  },
  {
    id: '2',
    type: 'video',
    src: '/videos/forest.mp4',
    poster: '/images/forest-poster.jpg',
    alt: 'Forest path',
    title: 'Forest Trail',
    description: 'Winding path through a dense forest.',
  },
  {
    id: '3',
    type: 'html',
    html: '<h2>Welcome</h2><p>Custom HTML content</p>',
    title: 'Custom Content',
    description: 'An HTML slide with custom content.',
  },
];

function MyGallery() {
  const handleMediaChange = (index, item) => {
    console.log(`Now viewing: ${item.title}`);
  };

  return (
    <Gallery
      media={myMedia}
      showThumbnails={true}
      thumbnailPosition="left"
      showArrows={true}
      showDescription={true}
      enableKeyboard={true}
      onMediaChange={handleMediaChange}
    />
  );
}
```

## Design decisions

### Image container
- Default 16:9 aspect ratio prevents layout shift
- `object-fit: contain` preserves image proportions
- Neutral background ($mg-color-neutral-50) fills empty space
- Supports all image aspect ratios

### Thumbnail scrolling
- Native overflow scrolling for performance
- Auto-scrolls selected thumbnail into view
- Custom scrollbar styling matches design system

### Navigation behavior
- Arrow buttons disable at boundaries (first/last image)
- Keyboard navigation works when gallery is focused
- Thumbnail clicking provides instant feedback

## Best practices

### Do's

- ✅ Provide meaningful `alt` text for all images
- ✅ Use descriptive titles and captions when helpful
- ✅ Keep image file sizes optimized for web
- ✅ Ensure images have appropriate resolution for display size
- ✅ Test keyboard navigation
- ✅ Verify contrast for arrow buttons on image backgrounds

### Don'ts

- ❌ Don't use identical `id` values for different images
- ❌ Don't omit `alt` text
- ❌ Don't disable keyboard navigation without good reason
- ❌ Don't use extremely large images without optimization
- ❌ Don't mix very different image qualities

## Browser support

- Modern browsers (Chrome, Firefox, Safari, Edge)
- CSS Grid for layout
- CSS aspect-ratio property for image containers
- object-fit for image sizing
- Graceful degradation for older browsers

## Changelog

1.0 — Initial component release

---

## Related components

- **Scroll Container**: Horizontal scrolling container with arrows
